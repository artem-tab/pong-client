<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Pong Vertical</title>
  <style>
    html, body { margin:0; height:100%; background:#000; overscroll-behavior:none; }
    #hud { position:fixed; top:12px; left:0; right:0; text-align:center; color:#fff; font:16px/1.2 sans-serif; }
    canvas { display:block; width:100vw; height:100vh; }
    .btn { position:fixed; bottom:14px; left:50%; transform:translateX(-50%); background:#111; color:#fff; border:1px solid #444; padding:10px 14px; border-radius:10px; }
  </style>

  <!-- Telegram SDK (–Ω–µ –º–µ—à–∞–µ—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –≤ Telegram) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Socket.IO –∫–ª–∏–µ–Ω—Ç —Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ -->
  <!-- –í–ê–ñ–ù–û: –∑–∞–º–µ–Ω–∏—Ç–µ YOUR_SERVER_URL –Ω–∞ –∞–¥—Ä–µ—Å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, https://pong-server.onrender.com) -->
  <script src="https://pong-server-dl39.onrender.com/socket.io/socket.io.js"></script>
</head>
<body>
  <div id="hud">–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è‚Ä¶</div>
  <canvas id="game"></canvas>
  <button id="readyBtn" class="btn" style="display:none">–ò–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>

  <script>
    const SERVER = "https://pong-server-dl39.onrender.com"; // ‚Üê –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL, –Ω–∞–ø—Ä–∏–º–µ—Ä: https://pong-server.onrender.com

    // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
    const socket = io(SERVER, { transports: ["websocket"] });

    const hud = document.getElementById('hud');
    const btn = document.getElementById('readyBtn');
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    function resize() { canvas.width = innerWidth; canvas.height = innerHeight; }
    addEventListener('resize', resize); resize();

    let mySide = "left";
    let roomId = null;
    let state = null;

    socket.on('connect', () => { hud.textContent = '–ò—â–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞‚Ä¶'; });
    socket.on('waiting', msg => { hud.textContent = msg; });

    socket.on('start', ({ room, sideOf }) => {
      roomId = room;
      mySide = sideOf[socket.id] || "left";
      hud.textContent = '–ú–∞—Ç—á –Ω–∞–π–¥–µ–Ω! üèì';
      btn.style.display = 'none';
    });

    socket.on('state', s => { state = s; render(); });
    socket.on('gameover', ({reason}) => { hud.textContent = '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞: ' + reason; btn.style.display='block'; });
    btn.onclick = () => location.reload();

    // –£–ü–†–ê–í–õ–ï–ù–ò–ï: –≤–µ—Ä—Ö —ç–∫—Ä–∞–Ω–∞ = –≤–≤–µ—Ä—Ö, –Ω–∏–∑ = –≤–Ω–∏–∑ (—Ç–∞—á/–º—ã—à—å)
    let up=false, down=false;
    function emitInput() {
      if (!roomId) return;
      socket.emit('input', { room: roomId, up, down });
    }
    addEventListener('touchstart', (e) => {
      const y = (e.touches[0]||e.changedTouches[0]).clientY;
      up = y < innerHeight/2; down = !up; emitInput();
    }, {passive:true});
    addEventListener('touchend', () => { up=false; down=false; emitInput(); }, {passive:true});
    addEventListener('mousedown', (e) => { up = e.clientY < innerHeight/2; down = !up; emitInput(); });
    addEventListener('mouseup', () => { up=false; down=false; emitInput(); });

    function render() {
      if (!state) return;
      const W = canvas.width, H = canvas.height;
      ctx.clearRect(0,0,W,H);

      // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø–æ–ª–µ –ø–æ–¥ —ç–∫—Ä–∞–Ω
      const sx = W / state.w, sy = H / state.h;
      const Sx = (x)=> x * sx, Sy = (y)=> y * sy;

      // –ü—É–Ω–∫—Ç–∏—Ä –ø–æ —Ü–µ–Ω—Ç—Ä—É
      ctx.fillStyle = "#222";
      for (let y=0;y<H;y+=20) ctx.fillRect(W/2-2, y, 4, 10);

      // –ú—è—á
      ctx.fillStyle = "#fff";
      ctx.beginPath();
      ctx.arc(Sx(state.ball.x), Sy(state.ball.y), Math.max(3, state.ball.r * (sx+sy)/2), 0, Math.PI*2);
      ctx.fill();

      // –†–∞–∫–µ—Ç–∫–∏
      const pm = state.paddle.margin, pw = state.paddle.w, ph = state.paddle.h;
      ctx.fillRect(Sx(pm), Sy(state.p1.y - ph/2), Sx(pw), Sy(ph)); // left
      ctx.fillRect(Sx(state.w - pm - pw), Sy(state.p2.y - ph/2), Sx(pw), Sy(ph)); // right

      // –°—á—ë—Ç
      ctx.fillStyle = "#fff";
      ctx.font = Math.floor(H*0.06) + "px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText(`${state.p1.score} : ${state.p2.score}`, W/2, H*0.09);
    }

    // Telegram Mini App: —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω, –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ Telegram
    const tg = window.Telegram?.WebApp;
    if (tg) { try { tg.expand(); } catch(_){} }
  </script>
</body>
</html>
